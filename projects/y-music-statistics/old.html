<!doctype html>
<html lang="en">
    <head>
        <!-- META TAGS -->
        <meta charset="utf-8">
        <meta name="viewport" content="width=device-width, initial-scale=1">
    
        <!-- PUBLIC -->
        <title>YouTube Music Unofficial Statistics</title>
        <meta name="author" content="Index's Projects">
        <meta name="site_name" content="Youtube Music Unofficial Statistics">
        <meta name="description" content="Ever wondered how much of your year was spent dedicated to music? Are you also a YouTube Music user? Well! You're in luck! (I am not affiliated with YouTube, YouTube Music, or Google)">
    
        <!-- RESOURCES -->
        <link rel="stylesheet" href="/style.css" type="text/css">
        <link href="https://cdn.jsdelivr.net/npm/halfmoon@2.0.1/css/halfmoon.min.css" rel="stylesheet" integrity="sha256-SsJizWSIG9JT9Qxbiy8xnYJfjCAkhEQ0hihxRn7jt2M=" crossorigin="anonymous">
        <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-C6RzsynM9kWDrMNeT87bh95OGNyZPhcTNXj1NW7RuBCsyN/o0jlpcV8Qyq46cDfL" crossorigin="anonymous"></script>
    </head>
    <body data-bs-theme="dark">
        <script>
            window.location.pathname = '/projects/y-music-statistics/'
        </script>
        <main id="page" class="small-page">
            <!-- TITLE -->
            <div class="text-center">
                <h1 id="page-title">YouTube Music Unofficial <span class="page-title-accent">Statistics</span></h1>
                <p>Made for YouTube Music (this project is not affiliated with YouTube in any way; this is an unofficial project)</p>
            </div>

            <div id="data">
                <!-- TOP 5 ARTISTS -->
                <div class="card mb-3">
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="mb-1">
                                <p class="small-heading text-muted mb-0">0 Streams</p>
                                <h3 style="color: gold;">Name</h3>
                            </li>
                            <li class="mb-1">
                                <p class="small-heading text-muted mb-0">0 Streams</p>
                                <h3 style="color: silver;">Name</h3>
                            </li>
                            <li class="mb-1">
                                <p class="small-heading text-muted mb-0">0 Streams</p>
                                <h3 style="color: brown;">Name</h3>
                            </li>
                            <li class="mb-1">
                                <p class="small-heading text-muted mb-0">0 Streams</p>
                                <h3>Name</h3>
                            </li>
                            <li class="mb-1">
                                <p class="small-heading text-muted mb-0">0 Streams</p>
                                <h3>Name</h3>
                            </li>
                        </ul>
                    </div>
                </div>
                
                <!-- BASIC STATISTICS -->
                <ul class="list-unstyled mb-0">
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Songs</p>
                            <h3>0</h3>
                            <small>STREAMED</small>
                        </div>
                    </li>
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Unique Songs</p>
                            <h3>0</h3>
                            <small>STREAMED</small>
                        </div>
                    </li>
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Unique Artists</p>
                            <h3>0</h3>
                            <small>STREAMED</small>
                        </div>
                    </li>
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Earliest-Latest</p>
                            <h3>12:00 AM -> 3:00 PM</h3>
                            <small>PLAYTIME</small>
                        </div>
                    </li>
                </ul>
            </div>
        </main>
        <script>
            const URLParams = new URLSearchParams(new URL(window.location.href).search)
            const Year = parseInt(URLParams.get('year')) || new Date().getFullYear()

            let Page = null
            let MusicHistory = []
            let ThisYear = []
            let SongPlays = []
            let MostPlayed = []
            let ArtistPlays = []
            let MostActiveArtist = []
            let MostPlayedByArtist = []
            let DaysOfTheWeek = [
                {day: "Sunday", plays: 0},
                {day: "Monday", plays: 0},
                {day: "Tuesday", plays: 0},
                {day: "Wednesday", plays: 0},
                {day: "Thursday", plays: 0},
                {day: "Friday", plays: 0},
                {day: "Saturday", plays: 0}
            ]
            let MostActiveWeekDay = null

            function Load(data) {
                if (new URLSearchParams(new URL(window.location.href).search).get('load') === 'false') { return }
                Page = document.getElementById('data')

                MusicHistory = data.filter((x) => x.header === "YouTube Music")
                ThisYear = MusicHistory.filter((x) => new Date(x.time).getFullYear() === Year)
                
                ThisYear.forEach(song => {
                    if (song.subtitles !== undefined) {
                        const Creator = song.subtitles[0].name.replace(' - Topic', '') || null;

                        const Title = song.title.replace('Watched ', '')
                        const SongExists = SongPlays.findIndex(play => play.name === Title)
                        if (SongExists !== -1) {
                            SongPlays[SongExists].plays++
                            DaysOfTheWeek[new Date(song.time).getDay()].plays++
                            if (MostPlayedByArtist[Creator] === undefined) { MostPlayedByArtist[Creator] = {name: "", plays: 0}}
                            if (SongPlays[SongExists].plays > (MostPlayedByArtist[Creator].plays || 0)) {
                                MostPlayedByArtist[Creator].name = Title
                                MostPlayedByArtist[Creator].plays = SongPlays[SongExists].plays
                            }
                        } else {
                            SongPlays.push({name: Title, artist: Creator, plays: 1})
                        }

                        const ArtistExists = ArtistPlays.findIndex(artist => artist.name === Creator);
                        if (ArtistExists !== -1) {
                            ArtistPlays[ArtistExists].plays++;
                        
                            if (ArtistPlays[ArtistExists].lastPlayed > new Date(song.time).getTime()) {
                                ArtistPlays[ArtistExists].lastPlayed = new Date(song.time).getTime()
                            }
                        } else {
                            ArtistPlays.push({ name: Creator, plays: 1, lastPlayed: new Date(song.time).getTime() });
                        }
                    }
                })

                MostPlayed = [...SongPlays].sort((a, b) => b.plays - a.plays).splice(0, 3);
                MostActiveArtist = [...ArtistPlays].sort((a, b) => b.plays - a.plays).splice(0, 5);
                MostActiveWeekDay = DaysOfTheWeek.sort((a, b) => b.plays - a.plays)[0]

                Page.innerHTML = `
                <!-- TOP 5 ARTISTS -->
                <h3 style="color: var(--bs-secondary);">MY TOP ARTISTS</h3>
                <div class="card mb-3">
                    <div class="card-body">
                        <ul class="list-unstyled">
                            <li class="mb-1">
                                <div class="row">
                                    <div class="col">
                                        <p class="small-heading text-muted mb-0">${MostActiveArtist[0].plays.toLocaleString()} Streams (~${Math.floor((MostActiveArtist[0].plays / ThisYear.length) * 100)}%)</p>
                                        <h3 style="color: gold;">${MostActiveArtist[0].name}</h3>    
                                    </div>
                                    <div class="col">
                                        <p class="small-heading text-muted mb-0">Most Played Song (${MostPlayedByArtist[MostActiveArtist[0].name].plays.toLocaleString()} streams)</p>
                                        <h3 style="color: gold;">${MostPlayedByArtist[MostActiveArtist[0].name].name}</h3>    
                                    </div>  
                                </div>
                            </li>
                            <li class="mb-1">
                                <div class="row">
                                    <div class="col">
                                        <p class="small-heading text-muted mb-0">${MostActiveArtist[1].plays.toLocaleString()} Streams (~${Math.floor((MostActiveArtist[1].plays / ThisYear.length) * 100)}%)</p>
                                        <h3 style="color: gray;">${MostActiveArtist[1].name}</h3>    
                                    </div>
                                    <div class="col">
                                        <p class="small-heading text-muted mb-0">Most Played Song (${MostPlayedByArtist[MostActiveArtist[1].name].plays.toLocaleString()} streams)</p>
                                        <h3 style="color: gray;">${MostPlayedByArtist[MostActiveArtist[1].name].name}</h3>    
                                    </div>  
                                </div>
                            </li>
                            <li class="mb-1">
                                <div class="row">
                                    <div class="col">
                                        <p class="small-heading text-muted mb-0">${MostActiveArtist[2].plays.toLocaleString()} Streams (~${Math.floor((MostActiveArtist[2].plays / ThisYear.length) * 100)}%)</p>
                                        <h3 style="color: coral;">${MostActiveArtist[2].name}</h3>    
                                    </div>
                                    <div class="col">
                                        <p class="small-heading text-muted mb-0">Most Played Song (${MostPlayedByArtist[MostActiveArtist[2].name].plays.toLocaleString()} streams)</p>
                                        <h3 style="color: coral;">${MostPlayedByArtist[MostActiveArtist[2].name].name}</h3>    
                                    </div>  
                                </div>
                            </li>
                            <li class="mb-1">
                                <p class="small-heading text-muted mb-0">${MostActiveArtist[3].plays.toLocaleString()} Streams (~${Math.floor((MostActiveArtist[3].plays / ThisYear.length) * 100)}%)</p>
                                <h3>${MostActiveArtist[3].name}</h3>
                            </li>
                            <li class="mb-1">
                                <p class="small-heading text-muted mb-0">${MostActiveArtist[4].plays.toLocaleString()} Streams (~${Math.floor((MostActiveArtist[4].plays / ThisYear.length) * 100)}%)</p>
                                <h3>${MostActiveArtist[4].name}</h3>
                            </li>
                        </ul>
                    </div>
                </div>

                <!-- INTERESTING STATISTICS -->
                <h3 style="color: var(--bs-secondary);">SOME INTERESTING STATISTICS</h3>
                <ul class="list-unstyled mb-0" id="interesting-statistics">
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Most Active Day of the Week</p>
                            <h3>${MostActiveWeekDay.day} with ${MostActiveWeekDay.plays.toLocaleString()} Streams</h3>
                        </div>
                    </li>
                    <!--
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Earliest-Latest Playtime</p>
                            <h3>* to be added</h3>
                        </div>
                    </li>
                    -->
                </ul>

                <!-- BASIC STATISTICS -->
                <h3 style="color: var(--bs-secondary);">SOME BASIC STATISTICS</h3>
                <ul class="list-unstyled mb-3" id="basic-statistics">
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Songs Streamed</p>
                            <h3>${ThisYear.length.toLocaleString()}</h3>
                        </div>
                    </li>
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Unique Songs Streamed</p>
                            <h3>${SongPlays.length.toLocaleString()}</h3>
                        </div>
                    </li>
                    <li class="card mb-3">
                        <div class="card-body">
                            <p class="small-heading text-muted mb-0">Unique Artists</p>
                            <h3>${ArtistPlays.length.toLocaleString()}</h3>
                        </div>
                    </li>
                </ul>
                `
            }
        </script>
    </body>
</html>